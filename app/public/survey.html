<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
        <title>Friend Finder - Survey</title>
    </head>
    <body>
        <div class="container">
            <h2 class="text-center">Survey Questions</h2>
            <hr/>
            <form>
                <h3 class="text-center">About you</h3>
                <div class="form-group">
                    <label for="name"><b>Name</b> <span style="color: red;">(required)</span></label>
                    <input type="text" class="form-control required" id="name" placeholder="Enter your name here" required>
                    <label for="photo"><b>Photo</b> <span style="color: red;">(required)</span></label>
                    <input type="text" class="form-control required" id="photo" placeholder="Enter link to your online photo" required>
                </div>
                <hr/>
                <h3 class="text-center">Questions</h3>
                <div class="form-group" method="post" action="/api/friends">

                    <label class="h5" for="quest1">Your friends can count on you.</label>
                    <select class="form-control" id="quest1" name="quest1">
                        <option value="1">1 (strongly disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3 (neither agree or disagree)</option>
                        <option value="4">4</option>
                        <option value="5">5 (strongly agree)</option>
                    </select>

                    <label class="h5" for="quest2">You would sacrifice yourself to save the world.</label>
                    <select class="form-control" id="quest2" name="quest2">
                        <option value="1">1 (strongly disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3 (neither agree or disagree)</option>
                        <option value="4">4</option>
                        <option value="5">5 (strongly agree)</option>
                    </select>

                    <label class="h5" for="quest3">Violence is the answer.</label>
                    <select class="form-control" id="quest3" name="quest3">
                        <option value="1">1 (strongly disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3 (neither agree or disagree)</option>
                        <option value="4">4</option>
                        <option value="5">5 (strongly agree)</option>
                    </select>

                    <label class="h5" for="ques4">You want to have a lot of money.</label>
                    <select class="form-control" id="quest4" name="quest4">
                        <option value="1">1 (strongly disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3 (neither agree or disagree)</option>
                        <option value="4">4</option>
                        <option value="5">5 (strongly agree)</option>
                    </select>

                    <label class="h5" for="quest5">You like hanging out with people.</label>
                    <select class="form-control" id="quest5" name="quest5">
                        <option value="1">1 (strongly disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3 (neither agree or disagree)</option>
                        <option value="4">4</option>
                        <option value="5">5 (strongly agree)</option>
                    </select>

                    <label class="h5" for="quest6">Shoot first, ask later.</label>
                    <select class="form-control" id="quest6" name="quest6">
                        <option value="1">1 (strongly disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3 (neither agree or disagree)</option>
                        <option value="4">4</option>
                        <option value="5">5 (strongly agree)</option>
                    </select>

                    <label class="h5" for="quest7">You want to live forever.</label>
                    <select class="form-control" id="quest7" name="quest7">
                        <option value="1">1 (strongly disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3 (neither agree or disagree)</option>
                        <option value="4">4</option>
                        <option value="5">5 (strongly agree)</option>
                    </select>

                    <label class="h5" for="quest8">You would pick technologies over magic.</label>
                    <select class="form-control" id="quest8" name="quest8">
                        <option value="1">1 (strongly disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3 (neither agree or disagree)</option>
                        <option value="4">4</option>
                        <option value="5">5 (strongly agree)</option>
                    </select>

                    <label class="h5" for="quest9">People usually ask you for advice.</label>
                    <select class="form-control" id="quest9" name="quest9">
                        <option value="1">1 (strongly disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3 (neither agree or disagree)</option>
                        <option value="4">4</option>
                        <option value="5">5 (strongly agree)</option>
                    </select>

                    <label class="h5" for="quest10">You run away when the going gets tough.</label>
                    <select class="form-control" id="quest10" name="quest10">
                        <option value="1">1 (strongly disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3 (neither agree or disagree)</option>
                        <option value="4">4</option>
                        <option value="5">5 (strongly agree)</option>
                    </select>
                </div>
                <div class="text-center">
                    <button type="submit" class="btn btn-lg btn-primary submit">Submit</button>
                </div>
            </form>
        </div>

        <footer class="footer">
            <div class="container">
                <p>
                    <a href="/api/friends" target="_blank">API Friends List</a>
                    <span> | </span>
                    <a href="https://github.com/nguyendviet/FriendFinder" target="_blank">GitHub Repo</a>
                </p>
            </div>
        </footer>

        <div class="modal fade">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Best Match</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>Your best friend is:</p>
                        <div class="friendName h3 text-center"></div>
                        <img class="friendPhoto" style="width: 100%;"></img>
                    </div>
                    <div class="modal-footer">
                        <a href="/survey"><button type="button" class="btn btn-primary">Fill Survey Again</button></a>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
        <script>
            $('.submit').on('click', (event) => {
                event.preventDefault();

                // check if user fills name and photo
                function fillForm() {
                    var filled = false;
                    var fillName = $('#name').val().trim();
                    var fillPhoto = $('#photo').val().trim();

                    if ((fillName !== '') && (fillPhoto !== '')) {
                        filled = true;
                    }
                   
                    return filled;
                }

                if (fillForm() == true) {
                    var scoreArr = [];

                    // store answers in scoreArr
                    for (i = 0; i < 10; i++) {
                        scoreArr.push($('#quest' + (i + 1)).val().trim());
                    }

                    // create new friend with answers
                    var newFriend = {
                        name: $("#name").val().trim(),
                        photo: $("#photo").val().trim(),
                        scores: scoreArr
                    };

                    // send new friend's info to server
                    $.post('/api/friends', newFriend, (data) => {
                        
                        // show modal when data comes back
                        $('.friendName').html(data.name);
                        $('.friendPhoto').attr('src', data.photo);
                        $('.modal').modal('show');
                    });
                }
                else {
                    alert('Please fill your form fully and hit submit again.');
                }    
            });
        </script>
    </body>
</html>